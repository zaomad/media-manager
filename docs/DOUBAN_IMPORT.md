# 豆瓣导入功能使用指南

Media Manager 提供了与豆瓣网站的集成功能，允许用户直接从豆瓣导入电影、图书和音乐信息。本文档详细介绍了该功能的使用方法和技术实现。

## 功能概述

豆瓣导入功能允许用户：
- 搜索豆瓣上的电影、图书和音乐
- 查看详细的条目信息
- 一键导入到媒体库
- 自定义状态、评分和笔记

## 使用方法

### 1. 搜索豆瓣内容

1. 点击导航栏中的"豆瓣搜索"链接
2. 在搜索框中输入关键词
3. 选择要搜索的内容类型（全部/电影/图书/音乐）
4. 点击"搜索"按钮

搜索结果将以卡片形式显示，包含以下信息：
- 标题和封面图片
- 豆瓣评分（如果有）
- 类型和年份
- 根据不同类型显示的额外信息：
  - 电影：导演和主演
  - 图书：作者和出版社
  - 音乐：艺术家和专辑信息

### 2. 查看详情

点击搜索结果中的"查看详情"按钮，进入详情页面。详情页面包含：
- 完整的条目信息
- 豆瓣评分
- 详细描述
- 导入表单

### 3. 导入到媒体库

在详情页面中：
1. 选择适当的状态：
   - 电影：未看/想看/已看
   - 音乐：未听/想听/已听
   - 图书：未读/想读/已读
2. 设置个人评分（0-5分）
3. 添加个人笔记（可选）
4. 点击"导入"按钮

导入成功后，系统会自动跳转到新导入条目的详情页面。

## 状态选项说明

### 电影状态
- **未看**：尚未观看的电影
- **想看**：计划观看的电影
- **已看**：已经观看过的电影

### 音乐状态
- **未听**：尚未收听的音乐
- **想听**：计划收听的音乐
- **已听**：已经收听过的音乐

### 图书状态
- **未读**：尚未阅读的图书
- **想读**：计划阅读的图书
- **已读**：已经阅读过的图书

## 技术实现

豆瓣导入功能主要由以下组件构成：

### 1. DoubanAPI 类
位于 `app/douban/api.py`，负责与豆瓣网站交互，包括：
- 搜索电影、图书和音乐
- 获取详细信息
- 解析HTML响应

### 2. DoubanService 类
位于 `app/douban/service.py`，负责处理豆瓣API返回的数据，包括：
- 数据格式转换
- 评分转换（10分制转5分制）
- 数据清洗和补充

### 3. 路由和视图
位于 `app/routes.py`，包括：
- 搜索页面路由
- 详情页面路由
- 导入功能路由
- API路由

### 4. 模板文件
- `templates/douban/search.html`：搜索页面
- `templates/douban/movie_detail.html`：电影详情页
- `templates/douban/book_detail.html`：图书详情页
- `templates/douban/music_detail.html`：音乐详情页

## 注意事项

1. 豆瓣导入功能依赖于豆瓣网站的HTML结构，如果豆瓣网站更新，可能需要相应更新解析代码。
2. 导入的封面图片不会保存到本地，只保存URL链接。
3. 导入时会自动生成新的UUID，不使用豆瓣的ID。
4. 状态值在导入后会自动转换为系统内部使用的格式。

## 常见问题

### Q: 为什么搜索结果中没有显示某些信息？
A: 豆瓣搜索结果页面提供的信息有限，详细信息需要在详情页面查看。

### Q: 为什么导入后的评分与豆瓣评分不同？
A: 系统使用5分制，而豆瓣使用10分制，导入时会自动进行转换。

### Q: 为什么音乐艺术家信息有时不准确？
A: 豆瓣音乐页面的艺术家信息格式不统一，系统会尝试从多个位置提取，但可能不完全准确。用户可以在导入前修改艺术家信息。

## 更新历史

- 2025-06-01: 修复了电影和音乐导入时的状态选择问题，统一了状态选项
- 2025-05-15: 改进了搜索结果卡片，显示更多媒体信息
- 2025-04-30: 添加了豆瓣导入功能的基本实现 